<!DOCTYPE html>
<html lang="en">
<head>
                                                                                                   <!-- importing bootstrap && other stuffs -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <link rel="shortcut icon" href="https://www.rutgers.edu/sites/all/themes/uwide/favicon.ico" type="image/vnd.microsoft.icon">
  <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA9FCsoZWld-8JgJwwz6H4GvM-JtYBDSfY&libraries=places"></script>

  <title>
    Rutgers ClassMapper
  </title>


    <title>Index</title>
    <style>
        /* Always set the map height explicitly to define the size of the div
         * element that contains the map. */
        #map {
          height: 100%;
        }
        /* Optional: Makes the sample page fill the window. */
        html, body {
          height: 100%;
          margin: 0;
          padding: 0;
        }
    </style>



</head>



<div class="p-4 mb-0 bg-danger text-white font-weight-bold clearfix">
  <div style="width: 3.5%; height: 3.5%; float: left; object-fit: contain;">
    <center>
      <img src=ruShield2.png style='height: 100%; width: 100%; object-fit: contain;'/>
    </center>
  </div>
  <h2 style="margin-left: 5%">
    Rutgers ClassMapper
  </h2>
</div>   <!-- Top div. -->
<div class="p-0 mb-0 bg-dark"></div>                                                                  <!-- stylistic stuff -->
<div class="p-2 mb-1 bg-dark"></div>                                                                  <!-- stylistic stuff -->
<div class="p-5 mb-2 text-white" style="height: 100%; margin-top: -1%">                                     <!-- File input Div -->
  <body scroll="no" style="overflow:hidden;">     <!-- disable scrolling -->
    <!--
    <center>
      <span class="border border-dark rounded">
        <p class="text-light d-inline p-4 bg-red text-dark">Upload your schedule (.ics file) here:</p>
      </span>
        <p><br></p>
    </center>
    -->
  <div id='leftDiv' style='width:30%; float:left;'>    <!-- Master left side div -->
    <div id = "buttonDivMain" style="float: left; width: 100%;" class="clearfix">  <!-- Fits both submit and upload buttons in one div, has border and clearfix  -->
      <div id = "uploadAddress" style="width: 60%; padding-left: 0px">
        <center>
          <input type="text" id='addressSearch'class="form-control btn-outline-muted" placeholder="Address" aria-label="Address" style="float:left; width: 100%; float: left; margin-bottom: 1%;">
        </center>
      </div>
      <div id = "uploadButtonDiv" style="width: 22%; padding-left: 0px" >                                    <!-- Upload button floated left -->
        <center>
          <div class='new_Btn' style="float:left; width: 100%; float: left;">
            <button class = "btn btn-outline-dark" type ="button">Upload your schedule (.ics file) here!</button>
          </div>
          <input class="btn btn-primary" type='file' id='chatFileOpen' name='ics file' accept='.ics' style="display:none"> <!-- FILE INPUT -->
        </center>
      </div>

      <div id="greenChecker" style='height: 25px; width: 25px; float: left; padding-left: 0; padding-right: 0; margin-left: 2.5%;'>    <!-- div that holds the green check mark -->
        <center>
          <img src=greenTick.png style='height: 100%; width: 100%; object-fit: contain;'/>
        </center>
      </div>

      <div id = "submitButtonDiv" style="width: 22%; padding-right: 2%; padding-left: 0; float: right">               <!-- Submit button floated left to border upload button -->
        <button id = "submitButtonBUTTON" onclick='upload()' type="button" class="btn btn-primary btn-success btn-block border border-dark rounded"> Submit! </button>  <!-- submit button. INITIALIZED IN JS BELOW -->
      </div>

    </div>

    <div id='schedule' style='float:left;width:100%;padding-right:15px;padding-top:10px'>

        <style>
          table, th, td {
            border: 1.5px solid black;
            border-collapse: collapse;
          }
          th, td {
            padding: 10px;
            color: black;
          }
          th {
            text-align: center;
          }
        </style>

        <table id='table' style="width:100%">
          <tr>
            <th>Day</th>
            <th>Classes</th>

          </tr>
          <tr>
            <td>Monday</td>
            <td id = "monDesc">Nothing!</td>

          </tr>
          <tr>
            <td>Tuesday</td>
            <td id = "tueDesc">Nothing!</td>

          </tr>
          <tr>
            <td>Wednesday</td>
            <td id = "wedDesc">Nothing!</td>

          </tr>
          <tr>
            <td>Thursday</td>
            <td id = "thuDesc">Nothing!</td>

          </tr>
          <tr>
            <td>Friday</td>
            <td id = "friDesc">Nothing!</td>

          </tr>
        </table>

    </div>
  </div>
<style>
.tab {
  color: white;
  float:left;
  background-color: gray;
  text-align: center;
  width:19.8%;
  margin:.1%;
  cursor: pointer;
}
</style>


    <div style='float:right;width:70%;height:90%'>
      <div id='tabs'style="height:5%">
        <div onclick='mon()' id='mon'class='tab' >Monday</div>
        <div onclick='tue()' id='tue'class='tab' >Tuesday</div>
        <div onclick='wed()' id='wed'class='tab' >Wednesday</div>
        <div onclick='thu()' id='thu'class='tab' >Thursday</div>
        <div onclick='fri()' id='fri'class='tab' >Friday</div>



      </div>
    <div id = "map" style="" class="clearfix">  <!-- div for the map -->
      <script>
        var map;
          function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
              center: {lat: 40.504746, lng: -74.451802}, //40.504746, -74.451802
              zoom: 14
              });
            var line = "y~ivFtzmeMZaAf@wAcDmFM]EMMMh@gCd@mC@SA}@s@_Im@eHO{AMaB@]Ae@@k@LaA`A}E~@cE|A{HrAkGf@_DpAeK\\_Bd@cB`@}@\\YP?JEHMDQ?Q?GVoB`BsDpC}FBIc@c@w@u@YWKAcAaAgAeAE@OVIWCCSO?IfAaCo@k@}@u@EKAKVeANDP?LITa@F";

            }

            // Script to hide submit button:
            //document.getElementById("submitButtonDiv").style.disabled;

        </script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA9FCsoZWld-8JgJwwz6H4GvM-JtYBDSfY&callback=initMap"
        async defer></script>

    </div>
  </div>
  </body>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>
<script>
var socket = io.connect('http://127.0.0.1:4000');
function gray(){

  var children = document.getElementById('tabs').children;
  for (var i = 0; i < children.length; i++) {
  var child = children[i];
  child.style.backgroundColor='gray';
  // Do stuff
}
}
mon();
function mon(){
  gray();
  document.getElementById('mon').style.backgroundColor='black';
  socket.emit('getDayRouteSocket',"Monday");
}
function tue(){
  gray();
  document.getElementById('tue').style.backgroundColor='black';
  socket.emit('getDayRouteSocket',"Tuesday");
}
function wed(){
  gray();
  document.getElementById('wed').style.backgroundColor='black';
  socket.emit('getDayRouteSocket',"Wednesday");
}
function thu(){
  gray();
  document.getElementById('thu').style.backgroundColor='black';
  socket.emit('getDayRouteSocket',"Thursday");
}
function fri(){
  gray();
  document.getElementById('fri').style.backgroundColor='black';
  socket.emit('getDayRouteSocket',"Friday");
}

document.getElementById("submitButtonBUTTON").disabled = true;  // initialize button to diabled
document.getElementById("greenChecker").style.opacity = '0.0'; // initialize green check to 'hidden' state

var input = document.querySelector('input');
input.addEventListener('change', updateSubmitButton);  // looks for change in upload value of upload button

function updateSubmitButton(){

  // function to reenale submit button after someone actually uploads file onto cache.
  document.getElementById("submitButtonBUTTON").disabled = false;
  document.getElementById("greenChecker").style.opacity = '1.0';
}

$('.new_Btn').on("click" , function () {
    $('#chatFileOpen').click();
});

function upload(){

  var length = input.files.length;
  input.files.item(0).text().then(text => socket.emit('upload',{file:text}));
}

socket.on("polyline",function(data){
  initMap();
  let line1 = new google.maps.Polyline({
    path: data.line,
    strokeColor: '#FF0000',
	  strokeOpacity: 1.0,
	  strokeWeight: 2
  });

  for(i = 0; i < data.destinations.length; i++) {
    let marker = new google.maps.Marker({
      position: data.destinations[i]["location"],
      title: data.destinations[i]["address"],
      map: map,
      clickable: true
    });

    let label = "<p style='color:black'>"+data.destinations[i]['address']+"</p>";
    let infoWindow = new google.maps.InfoWindow({
      position: marker.getPosition(),
      content: label
    });

    marker.addListener('click', function() {
       infoWindow.open(map, marker)
    })
  }


  line1.setMap(map);
  //map.addOverlay(line1);
  //map.addPolyline(line1);
});

socket.on("textSchedule",function(class_details){
  // console.log(class_details);
  // calls tableOrganizer function and passes 5 parameters. each param is an array of the respective day.
  tableOrganizer(class_details["Monday"], class_details["Tuesday"], class_details["Wednesday"], class_details["Thursday"], class_details["Friday"]);
});

//script to put all classes under their respective day's table row.
//5 arrays, traverses each array.
function tableOrganizer(monArray, tueArray, wedArray, thuArray, friArray){    // logic for parsing array for each day and putting in table

  table = document.getElementById("table");
  var agenda;
  var classElement;

  for(i = 0; i < monArray.length; i++){
    classElement = monArray[i];
    agenda = agenda + String(classElement) + "<br>";
  }

  document.getElementById("monDesc").textContent = agenda;

  for(i = 0; i < tueArray.length; i++){
    classElement = tueArray[i];
    agenda = agenda + String(classElement) + "<br>";
  }

  document.getElementById("tueDesc").textContent = agenda;

  for(i = 0; i < wedArray.length; i++){
    classElement = wedArray[i];
    agenda = agenda + String(classElement) + "<br>";
  }

  document.getElementById("wedDesc").textContent = agenda;

  for(i = 0; i < thuArray.length; i++){
    classElement = thuArray[i];
    agenda = agenda + String(classElement) + "<br>";
  }

  document.getElementById("thuDesc").textContent = agenda;

  for(i = 0; i < friArray.length; i++){
    classElement = friArray[i];
    agenda = agenda + String(classElement) + "<br>";
  }

  document.getElementById("friDesc").textContent = agenda;

}
var input = document.getElementById('addressSearch');
new google.maps.places.Autocomplete(input);
google.maps.event.addDomListener(window, 'load', initialize);


</script>
</html>
